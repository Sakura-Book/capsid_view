<div class="container mx-auto">
    <!-- Simple controls -->
    <div class="bg-white p-4 rounded-lg shadow mb-4 flex items-center gap-4">
        <label for="columns" class="font-medium whitespace-nowrap">Columns:</label>
        <input type="range" id="columns" min="1" max="6" value="3" class="flex-grow">
        <span id="columns-value" class="font-medium">3</span>
    </div>
    
    <!-- Grid container -->
    <div id="grid-container" class="grid gap-4">
        <!-- Grid items will be dynamically inserted here -->
    </div>
</div>

<style>
.molecule-viewer {
    position: relative;
    width: 100%;
    height: 100%;
    background-color: #ffffff;
}
</style>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/molstar@latest/build/viewer/molstar.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/molstar@latest/build/viewer/molstar.css" />

<script>
// 分子構造のデータ
const structures = [
    {
        id: 'viewer1',
        name: '1h9t',
        url: 'https://files.rcsb.org/download/1H9T.pdb',
        format: 'pdb'
    },
    {
        id: 'viewer2',
        name: '1cbs',
        url: 'https://files.rcsb.org/download/1CBS.pdb',
        format: 'pdb'
    },
    {
        id: 'viewer3',
        name: '1ubq',
        url: 'https://files.rcsb.org/download/1UBQ.pdb',
        format: 'pdb'
    }
];

// グリッドアイテムを生成する関数
function createGridItem(structure) {
    return `
        <div class="bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-2">${structure.name}</h2>
            <div id="${structure.id}" class="w-full h-64">
                <div class="molecule-viewer"></div>
            </div>
        </div>
    `;
}

// Molstarビューアのオプション
const viewerOptions = {
    layoutIsExpanded: false,
    layoutShowControls: true,
    layoutShowRemoteState: false,
    layoutShowSequence: false,
    layoutShowLog: false,
    layoutShowLeftPanel: false,
    layoutShowStructureSourceControls: false,
    viewportShowAnimation: false,
    viewportShowExpand: true,
    viewportShowSelectionMode: false,
    viewportShowTrajectoryControls: false,
    representationStyle: {
        type: 'cartoon',
        params: {}, 
        theme: {
            globalName: 'chain-id'
        }
    }
};

// グリッドを更新する関数
function updateGrid() {
    const gridContainer = document.getElementById('grid-container');
    const columns = document.getElementById('columns').value;
    document.getElementById('columns-value').textContent = columns;

    // グリッドのカラム数を更新
    gridContainer.className = `grid gap-4 grid-cols-${columns}`;

    // グリッドアイテムを生成
    gridContainer.innerHTML = structures.map(createGridItem).join('');

    // molstarビューアを初期化
    structures.forEach(structure => {
        molstar.Viewer.create(structure.id, viewerOptions)
            .then(viewer => {
                viewer.loadStructureFromUrl(structure.url, structure.format)
                    .then(() => {
                        // デフォルトのスタイルを適用
                        const plugin = viewer.plugin;
                        const defaultPreset = plugin.representation.structure.themes.presets.default;
                        defaultPreset.apply(plugin);
                    });
            });
    });
}

// スライダーの変更イベントを監視
document.getElementById('columns').addEventListener('input', updateGrid);

// 初期表示
updateGrid();
</script>
